#This is the Makefile for Lab 1 Blinky for ELEC424 Fall 2013
# Authors: Steven Arroyo and Lin Zhong, Rice University


# use the arm compiler 
CC = arm-none-eabi-gcc

# Define paths for all included files.  This assumes STM standard library was placed unmodified 
# in a folder called lib/ as outlined in the lab description.
FreeRTOS_Core = FreeRTOS
FreeRTOS_Core_Include = $(FreeRTOS_Core)/include
FreeRTOS_ARM_CM3 = $(FreeRTOS_Core)/portable/GCC/ARM_CM3

# Define the compiler flags
CFLAGS = -O0 -g3 -mcpu=cortex-m3 -mthumb -I$(FreeRTOS_Core) -I$(FreeRTOS_Core_Include) -I$(FreeRTOS_ARM_CM3) -I$(INC) $(FreeRTOS_Core_Include)/FreeRTOS.h $(INC)/FreeRTOSConfig.h -Wl,--gc-sections -T

# build all relevant files and create .elf
all:
	$(CC) $(CFLAGS)  $(STM_STARTUP)/startup_stm32f10x_md.s stm32f10x.h system_stm32f10x.c stm32f10x_tim.h stm32f10x_tim.c system_stm32f10x.h blinky.c liblab3.a lab3.h $(FreeRTOS_Core)/queue.c $(FreeRTOS_Core_Include)/queue.h $(FreeRTOS_Core)/tasks.c $(FreeRTOS_Core_Include)/semphr.h $(FreeRTOS_Core_Include)/task.h $(FreeRTOS_ARM_CM3)/port.c $(FreeRTOS_ARM_CM3)/portmacro.h $(FreeRTOS_Core_Include)/FreeRTOS.h $(INC)/FreeRTOSConfig.h $(STM_STD_PERIF)/src/stm32f10x_gpio.c $(STM_STD_PERIF)/src/stm32f10x_rcc.c -o blinky.elf


